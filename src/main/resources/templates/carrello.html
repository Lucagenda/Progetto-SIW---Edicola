<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>Il tuo carrello</title>
</head>
<body>
    <div style="position: absolute; top: 20px; right: 30px;">
        <a th:href="@{/}" title="Torna alla Homepage" style="font-weight:bold; font-size:18px; color:#c00; text-decoration:none;">Torna alla Homepage</a>
    </div>
    <h1>Carrello</h1>

    <table border="1">
        <thead>
            <tr>
                <th>Prodotto</th>
                <th>Prezzo unitario</th>
                <th>Quantità</th>
                <th>Totale riga</th>
                <th>Azioni</th>
            </tr>
        </thead>
        <tbody>
            <tr th:each="voce : ${carrello.voci}">
                <td th:text="${voce.prodotto.nome}">Nome prodotto</td>
                <td th:text="${voce.prodotto.prezzo} + ' €'">Prezzo</td>
                <td th:text="${voce.quantita}">Quantità</td>
                <td th:text="${voce.prodotto.prezzo * voce.quantita} + ' €'">Totale riga</td>
                <td>
                    <a th:href="@{'/carrello/rimuovi/' + ${voce.id}}">Rimuovi</a>
                </td>
            </tr>
        </tbody>
    </table>

    <h3 th:text="'Totale carrello: ' + ${carrello.totale} + ' €'">Totale</h3>

    <!-- Pulsanti di checkout e svuota carrello -->
    <div style="display: flex; gap: 10px;">
      <form action="/carrello/checkout" method="post">
          <button type="submit">Crea Ordine</button>
      </form>
      <form action="/carrello/svuota" method="post">
          <button type="submit" style="background-color:#c00; color:white;">Svuota Carrello</button>
      </form>
    </div>

    <hr>

    <!-- Form per cercare prodotto per nome -->
    <h3>Cerca prodotto per nome</h3>
    <form class="search-bar" th:action="@{/prodotti/ricerca}" method="get">
        <input type="text" name="nome" placeholder="Nome prodotto..." required />
        <button type="submit">Cerca</button>
    </form>

    <!-- Se ci sono risultati mostra la selezione -->
    <div th:if="${prodotti != null}">
        <form th:action="@{/carrello/aggiungi}" method="post">
            <select name="id" required>
                <option th:each="prodotto : ${prodotti}" th:value="${prodotto.id}" th:text="${prodotto.nome + ' - ' + prodotto.prezzo + '€'}"></option>
            </select>
            <input type="number" name="quantita" min="1" value="1" required />
            <button type="submit">Aggiungi al carrello</button>
        </form>
    </div>

    <!-- Se la ricerca non trova nessun prodotto -->
    <div th:if="${prodotti != null and #lists.size(prodotti) == 0}">
        <div style="position: absolute; top: 20px; right: 30px;">
            <a th:href="@{/carrello}" title="Torna al carrello" style="font-weight:bold; font-size:18px; color:#007bff; text-decoration:none;">Torna al carrello</a>
        </div>
        <p>Nessun prodotto trovato.</p>
    </div>
</body>
</html>